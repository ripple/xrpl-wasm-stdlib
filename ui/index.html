<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Escrow Testing UI</title>
    <script src="https://unpkg.com/xrpl@4.5.0-smartescrow.4/build/xrpl-latest-min.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Smart Escrow Testing UI</h1>
        <p>Deploy and test XRPL Smart Escrows with ease</p>
        <div class="status-bar">
          <div
            id="connectionStatus"
            class="status-indicator status-disconnected"
          >
            Disconnected
          </div>
          <div id="networkInfo" class="status-indicator status-disconnected">
            No Network
          </div>
        </div>
      </div>

      <div class="grid">
        <!-- Network Configuration -->
        <div class="card">
          <h2>Network Configuration</h2>
          <div class="form-group">
            <label>Select Network:</label>
            <div class="radio-group">
              <div class="radio-item">
                <input
                  type="radio"
                  id="devnet"
                  name="network"
                  value="wss://wasm.devnet.rippletest.net:51233"
                  checked
                />
                <label for="devnet">WASM Devnet</label>
              </div>
              <div class="radio-item">
                <input
                  type="radio"
                  id="localNode"
                  name="network"
                  value="ws://127.0.0.1:6006"
                />
                <label for="localNode">Local Node</label>
              </div>
            </div>
          </div>
          <button id="connectBtn" class="btn" onclick="connectToNetwork()">
            Connect
          </button>
          <button
            id="disconnectBtn"
            class="btn btn-warning"
            onclick="disconnectFromNetwork()"
            style="display: none"
          >
            Disconnect
          </button>
        </div>

        <!-- WASM Code Management -->
        <div class="card">
          <h2>WASM Code Management</h2>
          <div class="tabs">
            <button class="tab active" onclick="switchTab('examples')">
              Examples
            </button>
            <button class="tab" onclick="switchTab('upload')">
              Upload File
            </button>
            <button class="tab" onclick="switchTab('paste')">Paste Hex</button>
          </div>

          <div id="examples-tab" class="tab-content active">
            <div class="form-group">
              <label>Pre-built Examples:</label>
              <div class="examples-grid">
                <!-- Dynamic WASM example buttons - generated by embed-wasm.sh -->
                <button
                  class="btn btn-small"
                  onclick="loadExample('atomic_swap1')"
                >
                  Atomic Swap1
                </button>
                <button
                  class="btn btn-small"
                  onclick="loadExample('atomic_swap2')"
                >
                  Atomic Swap2
                </button>
                <button
                  class="btn btn-small"
                  onclick="loadExample('hello_world')"
                >
                  Hello World
                </button>
                <button class="btn btn-small" onclick="loadExample('kyc')">
                  Kyc
                </button>
                <button
                  class="btn btn-small"
                  onclick="loadExample('ledger_sqn')"
                >
                  Ledger Sqn
                </button>
                <button
                  class="btn btn-small"
                  onclick="loadExample('nft_owner')"
                >
                  Nft Owner
                </button>
                <button class="btn btn-small" onclick="loadExample('notary')">
                  Notary
                </button>
                <button class="btn btn-small" onclick="loadExample('oracle')">
                  Oracle
                </button>

                <!-- End dynamic WASM example buttons -->
              </div>
            </div>
          </div>

          <div id="paste-tab" class="tab-content">
            <div class="form-group">
              <label for="wasmHex">WASM Hex Code:</label>
              <textarea
                id="wasmHex"
                class="form-control"
                rows="4"
                placeholder="Paste hex-encoded WASM here..."
              ></textarea>
            </div>
            <button class="btn btn-small" onclick="loadWasmFromHex()">
              Load Hex
            </button>
          </div>

          <div id="upload-tab" class="tab-content">
            <div class="form-group">
              <label for="wasmFile">Upload WASM File:</label>
              <input
                type="file"
                id="wasmFile"
                class="form-control"
                accept=".wasm"
                onchange="handleWasmFile()"
              />
            </div>
          </div>

          <div class="form-group">
            <label>Current WASM:</label>
            <div class="wasm-status">
              <div id="currentWasm" class="wasm-info">No WASM loaded</div>
              <div id="currentWasmReadme" class="wasm-readme-link hidden">
                <a href="" target="_blank" class="btn btn-small btn-secondary"
                  >View README</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid">
        <!-- Account and Escrow Management Wrapper -->
        <div class="sidebar-column">
          <!-- Account Management -->
          <div class="card">
            <h2>Account Management</h2>
            <div class="form-group">
              <button
                id="generateBtn"
                class="btn btn-success"
                onclick="generateAccount()"
              >
                Generate New Account
              </button>
              <button
                id="fundBtn"
                class="btn btn-warning"
                onclick="fundSelectedAccount()"
                style="display: none"
              >
                Fund Selected
              </button>
            </div>
            <div
              id="accountLoading"
              class="account-loading"
              style="display: none"
            >
              <div class="loading-container">
                <div class="spinner"></div>
                <span id="loadingText">Generating account...</span>
              </div>
            </div>
            <div class="accounts-list" id="accountsList">
              <div class="empty-state">
                No accounts loaded. Generate or load accounts to get started.
              </div>
            </div>
          </div>

          <!-- Escrow Management -->
          <div class="card">
            <h2>Escrow Management</h2>
            <div class="escrows-list" id="escrowsList">
              <div class="empty-state">
                No escrows created. Deploy WASM to create escrows.
              </div>
            </div>
          </div>
        </div>

        <!-- Transaction Interface -->
        <div class="card">
          <h2>Transaction Interface</h2>
          <div class="tabs">
            <button class="tab active" onclick="switchTxTab('deploy-wasm')">
              Deploy WASM
            </button>
            <button class="tab" onclick="switchTxTab('escrow-finish')">
              Finish Escrow
            </button>
            <button class="tab" onclick="switchTxTab('custom')">
              Custom TX
            </button>
          </div>

          <div id="deploy-wasm-tab" class="tab-content active">
            <div id="wasmWarning" class="wasm-warning hidden">
              ‚ö†Ô∏è No WASM code loaded. Please load WASM code from the "WASM Code
              Management" card first.
            </div>
            <div class="form-group">
              <label for="escrowSourceAccount">Source Account (Owner):</label>
              <select id="escrowSourceAccount" class="form-control">
                <option value="">Select source account...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="escrowDestination">Destination Account:</label>
              <select id="escrowDestination" class="form-control">
                <option value="">Select destination account...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="escrowAmount">Escrow Amount (drops):</label>
              <input
                type="text"
                id="escrowAmount"
                class="form-control"
                value="100000"
              />
            </div>
            <div class="form-group">
              <label>Current WASM:</label>
              <div class="wasm-status">
                <div id="deployWasmStatus" class="wasm-info">
                  No WASM loaded
                </div>
                <div id="deployWasmReadme" class="wasm-readme-link hidden">
                  <a href="" target="_blank" class="btn btn-small btn-secondary"
                    >View README</a
                  >
                </div>
              </div>
            </div>

            <!-- Advanced Options for Deploy WASM -->
            <div class="advanced-options" id="deployAdvancedOptions">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="toggleAdvancedOptions('deploy')"
                style="
                  width: 100%;
                  margin-bottom: 10px;
                  background: #f8f9fa;
                  color: #333;
                  border: 1px solid #ddd;
                "
              >
                <span id="deployAdvancedToggleText">Show Advanced Options</span>
                <span id="deployAdvancedToggleIcon">‚ñº</span>
              </button>
              <div id="deployAdvancedContent" class="advanced-content hidden">
                <h4 class="advanced-title">Additional Transaction Fields</h4>
                <div class="form-group">
                  <label for="deployMemos">Memos (JSON array):</label>
                  <textarea
                    id="deployMemos"
                    class="form-control"
                    rows="2"
                    placeholder='[{"Memo": {"MemoType": "text", "MemoData": "example"}}]'
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="deployCondition">Condition (hex):</label>
                  <input
                    type="text"
                    id="deployCondition"
                    class="form-control"
                    placeholder="A0258020..."
                  />
                </div>
                <div class="form-group">
                  <label for="deployData">Data (hex):</label>
                  <input
                    type="text"
                    id="deployData"
                    class="form-control"
                    placeholder="Additional hex data for the escrow"
                  />
                </div>
                <div class="form-group">
                  <label for="deployDestinationTag">Destination Tag:</label>
                  <input
                    type="number"
                    id="deployDestinationTag"
                    class="form-control"
                    placeholder="12345"
                  />
                </div>
                <div class="form-group">
                  <label for="deployCustomFields">Custom Fields (JSON):</label>
                  <textarea
                    id="deployCustomFields"
                    class="form-control"
                    rows="3"
                    placeholder='{"CustomField": "value", "AnotherField": 123}'
                  ></textarea>
                </div>
              </div>
            </div>

            <button class="btn btn-success" onclick="deployCurrentWasm()">
              Deploy WASM as Smart Escrow
            </button>
          </div>

          <div id="escrow-finish-tab" class="tab-content">
            <div class="form-group">
              <label for="escrowSelect">Select Escrow:</label>
              <select
                id="escrowSelect"
                class="form-control"
                onchange="updateFinishFormFromEscrow()"
              >
                <option value="">Select an escrow to finish...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="finishSourceAccount"
                >Source Account (Finisher):</label
              >
              <select id="finishSourceAccount" class="form-control">
                <option value="">Select source account...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="ownerAccount">Owner Account:</label>
              <select id="ownerAccount" class="form-control">
                <option value="">Select owner account...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="offerSequence">Offer Sequence:</label>
              <input
                type="text"
                id="offerSequence"
                class="form-control"
                placeholder="Sequence will be filled when you select an escrow"
                readonly
              />
            </div>

            <!-- Advanced Options for Finish Escrow -->
            <div class="advanced-options" id="finishAdvancedOptions">
              <button
                type="button"
                class="btn btn-secondary advanced-toggle"
                onclick="toggleAdvancedOptions('finish')"
              >
                <span id="finishAdvancedToggleText">Show Advanced Options</span>
                <span id="finishAdvancedToggleIcon">‚ñº</span>
              </button>
              <div id="finishAdvancedContent" class="advanced-content hidden">
                <h4 class="advanced-title">Additional Transaction Fields</h4>
                <div class="form-group">
                  <label for="finishMemos">Memos (JSON array):</label>
                  <textarea
                    id="finishMemos"
                    class="form-control"
                    rows="2"
                    placeholder='[{"Memo": {"MemoType": "text", "MemoData": "example"}}]'
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="finishFulfillment">Fulfillment (hex):</label>
                  <input
                    type="text"
                    id="finishFulfillment"
                    class="form-control"
                    placeholder="A0028000..."
                  />
                </div>
                <div class="form-group">
                  <label for="finishComputationAllowance"
                    >Computation Allowance:</label
                  >
                  <input
                    type="number"
                    id="finishComputationAllowance"
                    class="form-control"
                    placeholder="1000000"
                    value="1000000"
                  />
                </div>
                <div class="form-group">
                  <label for="finishCustomFields">Custom Fields (JSON):</label>
                  <textarea
                    id="finishCustomFields"
                    class="form-control"
                    rows="3"
                    placeholder='{"CustomField": "value", "AnotherField": 123}'
                  ></textarea>
                </div>
              </div>
            </div>

            <button class="btn btn-success" onclick="finishEscrow()">
              Finish Escrow
            </button>
          </div>

          <div id="custom-tab" class="tab-content">
            <div class="form-group">
              <label for="customSourceAccount">Source Account:</label>
              <select
                id="customSourceAccount"
                class="form-control"
                onchange="updateCustomTxAccount()"
              >
                <option value="">Select source account...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="customTx">Custom Transaction JSON:</label>
              <textarea
                id="customTx"
                class="form-control"
                rows="6"
                placeholder='{"TransactionType": "Payment", "Amount": "1000000", "Destination": "rABC...", ...}'
              ></textarea>
            </div>
            <button class="btn btn-success" onclick="submitCustomTransaction()">
              Submit Transaction
            </button>
          </div>
        </div>
      </div>

      <!-- Smart Escrow Testing -->
      <div class="card">
        <h2>Smart Escrow Testing</h2>
        <div class="quick-test-controls">
          <button class="btn btn-danger" onclick="clearLogs()">
            Clear Logs
          </button>
        </div>
        <div class="log-area" id="logArea"></div>
      </div>
    </div>

    <script>
      // Global state
      let client = null
      let currentWasm = null
      let accounts = []
      let escrows = []
      let selectedAccount = null
      let lastOfferSequence = null
      let ledgerInterval = null

      // Utility Functions
      function log(message, isHtml = false) {
        const logArea = document.getElementById("logArea")
        const timestamp = new Date().toLocaleTimeString()

        if (isHtml) {
          // Create a new div for HTML content
          const logEntry = document.createElement("div")
          logEntry.innerHTML = `[${timestamp}] ${message}`
          logArea.appendChild(logEntry)
          // Add a newline after HTML content
          const newline = document.createElement("div")
          newline.textContent = ""
          logArea.appendChild(newline)
        } else {
          // Use innerHTML to preserve existing content and avoid mixing textContent/innerHTML
          const logEntry = document.createElement("div")
          logEntry.textContent = `[${timestamp}] ${message}`
          logArea.appendChild(logEntry)
        }

        logArea.scrollTop = logArea.scrollHeight
      }

      function showToast(message, type = "error") {
        // Remove any existing toasts
        const existingToasts = document.querySelectorAll(".toast")
        existingToasts.forEach((toast) => toast.remove())

        // Create new toast
        const toast = document.createElement("div")
        toast.className = `toast ${type}`
        toast.innerHTML = `
          ${message}
          <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
        `

        document.body.appendChild(toast)

        // Show toast with animation
        setTimeout(() => toast.classList.add("show"), 100)

        // Auto-remove after 5 seconds
        setTimeout(() => {
          if (toast.parentElement) {
            toast.classList.remove("show")
            setTimeout(() => toast.remove(), 300)
          }
        }, 5000)
      }

      function logError(message, toastType = "error") {
        log(message)
        showToast(message, toastType)
      }

      function clearLogs() {
        const logArea = document.getElementById("logArea")
        logArea.textContent = ""
        logArea.innerHTML = ""
      }

      function getExplorerUrl(hash) {
        const selectedNetwork = document.querySelector(
          'input[name="network"]:checked',
        )?.value

        if (
          selectedNetwork &&
          selectedNetwork.includes("wasm.devnet.rippletest.net")
        ) {
          return `http://custom.xrpl.org/wasm.devnet.rippletest.net/transactions/${hash}`
        } else if (
          selectedNetwork &&
          (selectedNetwork.includes("localhost") ||
            selectedNetwork.includes("127.0.0.1"))
        ) {
          return `http://custom.xrpl.org/localhost:6006/transactions/${hash}`
        }

        // Default to devnet explorer if network detection fails
        return `http://custom.xrpl.org/wasm.devnet.rippletest.net/transactions/${hash}`
      }

      function logWithExplorer(message, hash = null) {
        log(message)

        if (hash) {
          const explorerUrl = getExplorerUrl(hash)
          if (explorerUrl) {
            log(
              `üîó View in explorer: <a href="${explorerUrl}" target="_blank" class="explorer-link">${explorerUrl}</a>`,
              true,
            )
          }
        }
      }

      function updateConnectionStatus(connected, network = "") {
        const status = document.getElementById("connectionStatus")
        const networkInfo = document.getElementById("networkInfo")
        const connectBtn = document.getElementById("connectBtn")
        const disconnectBtn = document.getElementById("disconnectBtn")

        if (connected) {
          status.textContent = "Connected"
          status.className = "status-indicator status-connected"
          networkInfo.textContent = network
          networkInfo.className = "status-indicator status-connected"
          connectBtn.style.display = "none"
          disconnectBtn.style.display = "inline-block"
        } else {
          status.textContent = "Disconnected"
          status.className = "status-indicator status-disconnected"
          networkInfo.textContent = "No Network"
          networkInfo.className = "status-indicator status-disconnected"
          connectBtn.style.display = "inline-block"
          disconnectBtn.style.display = "none"
        }
      }

      // Advanced Options Management
      function toggleAdvancedOptions(section) {
        const content = document.getElementById(`${section}AdvancedContent`)
        const toggleText = document.getElementById(
          `${section}AdvancedToggleText`,
        )
        const toggleIcon = document.getElementById(
          `${section}AdvancedToggleIcon`,
        )

        if (content.classList.contains("hidden")) {
          content.classList.remove("hidden")
          toggleText.textContent = "Hide Advanced Options"
          toggleIcon.textContent = "‚ñ≤"
        } else {
          content.classList.add("hidden")
          toggleText.textContent = "Show Advanced Options"
          toggleIcon.textContent = "‚ñº"
        }
      }

      // Tab Management
      function switchTab(tabName) {
        // Get the parent card to scope the tab switching
        const parentCard = event.target.closest(".card")
        parentCard
          .querySelectorAll(".tab")
          .forEach((tab) => tab.classList.remove("active"))
        parentCard
          .querySelectorAll(".tab-content")
          .forEach((content) => content.classList.remove("active"))

        event.target.classList.add("active")
        document.getElementById(tabName + "-tab").classList.add("active")
      }

      function switchTxTab(tabName) {
        // Get the parent card to scope the tab switching
        const parentCard = event.target.closest(".card")
        parentCard
          .querySelectorAll(".tab")
          .forEach((tab) => tab.classList.remove("active"))
        parentCard
          .querySelectorAll(".tab-content")
          .forEach((content) => content.classList.remove("active"))

        event.target.classList.add("active")
        document.getElementById(tabName + "-tab").classList.add("active")
      }

      // Network Management
      async function connectToNetwork() {
        // Check if XRPL library is loaded
        if (typeof xrpl === "undefined") {
          log(
            "‚ùå XRPL library is not loaded. Please refresh the page and wait for it to load.",
          )
          return
        }

        const selectedNetwork = document.querySelector(
          'input[name="network"]:checked',
        ).value

        try {
          if (client && client.isConnected()) {
            await client.disconnect()
          }

          // Clear existing interval
          if (ledgerInterval) {
            clearInterval(ledgerInterval)
            ledgerInterval = null
          }

          log(`Connecting to ${selectedNetwork}...`)
          client = new xrpl.Client(selectedNetwork)

          // Add connection event listeners
          client.on("connected", () => {
            updateConnectionStatus(true, selectedNetwork)
            log(`Successfully connected to ${selectedNetwork}`)
          })

          client.on("disconnected", () => {
            updateConnectionStatus(false)
            log("Disconnected from network")
          })

          await client.connect()

          // Start ledger acceptance for local nodes
          if (
            selectedNetwork.includes("localhost") ||
            selectedNetwork.includes("127.0.0.1")
          ) {
            ledgerInterval = setInterval(() => {
              if (client && client.isConnected()) {
                client.request({ command: "ledger_accept" }).catch(() => {})
              }
            }, 1000)
          }
        } catch (error) {
          logError(`Failed to connect: ${error.message}`)
          updateConnectionStatus(false)
        }
      }

      async function disconnectFromNetwork() {
        try {
          if (ledgerInterval) {
            clearInterval(ledgerInterval)
            ledgerInterval = null
          }

          if (client && client.isConnected()) {
            await client.disconnect()
          }

          // Clear accounts and escrows
          accounts = []
          escrows = []
          selectedAccount = null

          // Update UI to reflect cleared state
          await updateAccountsList()
          await updateEscrowsList()

          updateConnectionStatus(false)
          log("Disconnected from network")
        } catch (error) {
          log(`Error disconnecting: ${error.message}`)
          updateConnectionStatus(false)
        }
      }

      // WASM Code Management
      function handleWasmFile() {
        const file = document.getElementById("wasmFile").files[0]
        if (!file) return

        const reader = new FileReader()
        reader.onload = function (e) {
          const arrayBuffer = e.target.result
          const bytes = new Uint8Array(arrayBuffer)
          currentWasm = Array.from(bytes)
            .map((b) => b.toString(16).padStart(2, "0"))
            .join("")

          const wasmInfo = `${file.name} (${Math.round(arrayBuffer.byteLength / 1024)}KB)`
          document.getElementById("currentWasm").textContent = wasmInfo
          document.getElementById("deployWasmStatus").textContent = wasmInfo
          // Hide README links for uploaded files
          document.getElementById("currentWasmReadme").classList.add("hidden")
          document.getElementById("deployWasmReadme").classList.add("hidden")
          updateWasmWarning()
          log(`Loaded WASM file: ${file.name}`)
        }
        reader.readAsArrayBuffer(file)
      }

      function loadWasmFromHex() {
        const hex = document.getElementById("wasmHex").value.trim()
        if (!hex) {
          logError("Please enter hex-encoded WASM data", "warning")
          return
        }

        currentWasm = hex.replace(/\s/g, "")
        const wasmInfo = `Hex data (${Math.round(currentWasm.length / 2 / 1024)}KB)`
        document.getElementById("currentWasm").textContent = wasmInfo
        document.getElementById("deployWasmStatus").textContent = wasmInfo
        // Hide README links for hex data
        document.getElementById("currentWasmReadme").classList.add("hidden")
        document.getElementById("deployWasmReadme").classList.add("hidden")
        updateWasmWarning()
        log("Loaded WASM from hex data")
      }

      // Embedded WASM examples as hex strings
      // To update these, run: ./ui/embed-wasm.sh
      const EMBEDDED_WASM = {
        atomic_swap1:
          "0061736d0100000001300860047f7f7f7f017f60037f7f7e017f60057f7f7f7f7f017f60037f7f7f017f60017f0060027f7f006000017f60000002aa010608686f73745f6c6962136765745f74785f6e65737465645f6669656c64000008686f73745f6c69620974726163655f6e756d000108686f73745f6c6962057472616365000208686f73745f6c69621063616368655f6c65646765725f6f626a000308686f73745f6c6962146765745f6c65646765725f6f626a5f6669656c64000008686f73745f6c69621c6765745f63757272656e745f6c65646765725f6f626a5f6669656c640003030a090405060407030303030405017001010105030100110619037f01418080c0000b7f0041e685c0000b7f0041f085c0000b073f05066d656d6f727902000e6765745f66697273745f6d656d6f00060666696e69736800080a5f5f646174615f656e6403010b5f5f686561705f6261736503020a861b09e10101027f23808080800041d0206b22012480808080002001410c6a4100418020108e808080001a2001418c206a410041c400108e808080001a2001418c206a4189803c1087808080002001418c206a41001087808080002001418c206a418d801c108780808000024002402001418c206a20012802cc202001410c6a418020108080808000220241004a0d00024020020d0020004282808080703702000c020b20004102360200200020023602040c010b200041046a2001410c6a418020108d808080001a2000200236028420200041013602000b200141d0206a2480808080000b6601027f23808080800041106b210202402000280240220341436a41bf7f490d002002200136020c410021010340200341c0004f0d01200020036a2002410c6a20016a2d00003a00002000200028024041016a2203360240200141016a22014104470d000b0b0bea0c01067f2380808080004190e1066b220024808080800020004190c1006a1086808080000240024020002802904122014102470d0041cd85c0800041192000280294412202ac1081808080001a0c010b410021022001410171450d002000280294612102200041086a20004194c1006a418020108d808080001a0240024002400240024020024120490d0020004188206a41186a200041086a41186a29000037030020004188206a41106a200041086a41106a29000037030020004188206a41086a200041086a41086a2900003703002000200029000837038820418080c08000412020004188206a412041011082808080001a4100210220004188206a4120410010838080800022014100480d0141a080c08000412842001081808080001a20004190c1006a41004180a006108e808080001a0240200141a0801c20004190c1006a4180a006108480808000220241004e0d0041ca84c0800041292002ac1081808080001a200221020c060b20024181a0064f0d020240024020024108490d002000280290414180c2cdeb06470d002000280294414101470d0020024180786a41819806490d010b41c880c08000413542001081808080001a0c050b41fd80c08000412242001081808080001a20004190216a4100418020108e808080001a02402001419b801c20004190216a4180201084808080002202417f4a0d0041ab84c08000411f2002ac1081808080001a0c060b200028029021210320004190c1006a41046a20004190216a41046a41fc1f108d808080001a20002003360290412000200236029061024002400240200241606a0e050001010100010b419f81c08000411720004190c1006a200241011082808080001a41b681c08000412b42001081808080001a200041a0216a2203410036020020004198216a2204420037030020004200370390214181802020004190216a411410858080800022024114460d0141c283c0800041252002417f2002417f481b2202ac1081808080001a0c070b41e783c0800041c4002002ad1081808080001a0c050b200041ac206a41026a20002d0092213a000020002000290097213703e820200020004190216a410c6a22052900003700ed20200041ac206a410c6a20002900ed20370000200020002f0190213b01ac2020002000280093213600af20200020002903e8203700b3202003410036020020044200370300200042003703902102404183802020004190216a411410858080800022024114460d00419983c0800041292002417f2002417f481b2202ac1081808080001a0c060b200041c0206a41026a20002d0092213a000020002000290097213703e820200020052900003700ed20200041c0206a410c6a20002900ed20370000200020002f0190213b01c02020002000280093213600c320200020002903e8203700c720200041a0216a2203410036020020004198216a220442003703002000420037039021024020014181802020004190216a411410848080800022024114460d0041f082c0800041292002417f2002417f481b2202ac1081808080001a0c060b200041d4206a41026a20002d0092213a000020002000290097213703e820200020004190216a410c6a22052900003700ed20200041d4206a410c6a20002900ed20370000200020002f0190213b01d42020002000280093213600d720200020002903e8203700db2020034100360200200442003703002000420037039021024020014183802020004190216a411410848080800022024114460d0041c382c08000412d2002417f2002417f481b2202ac1081808080001a0c060b200041e8206a41026a20002d0092213a00002000200029009721370380212000200529000037008521200041e8206a410c6a200029008521370000200020002f0190213b01e82020002000280093213600eb2020002000290380213700ef20200041ac206a200041e8206a4114108b808080000d030240200041c0206a200041d4206a4114108b808080000d00410121020c060b41e181c080004114200041c0206a411441011082808080001a41f581c08000411d200041d4206a411441011082808080001a0c040b419d85c0800041302002ad1081808080001a0c030b41f384c08000412a2001ac1081808080001a0c030b2002108980808000000b419282c080004110200041ac206a411441011082808080001a41a282c080004121200041e8206a411441011082808080001a0b410021020b20004190e1066a24808080800020020b0900108a80808000000b0300000b4a01037f4100210302402002450d000240034020002d0000220420012d00002205470d01200041016a2100200141016a21012002417f6a2202450d020c000b0b200420056b21030b20030bb907010c7f23808080800041106b210302400240200241104f0d00200021040c010b024020002000410020006b41037122056a22064f0d002005417f6a2107200021042001210802402005450d002005210920002104200121080340200420082d00003a0000200841016a2108200441016a21042009417f6a22090d000b0b20074107490d000340200420082d00003a0000200441016a200841016a2d00003a0000200441026a200841026a2d00003a0000200441036a200841036a2d00003a0000200441046a200841046a2d00003a0000200441056a200841056a2d00003a0000200441066a200841066a2d00003a0000200441076a200841076a2d00003a0000200841086a2108200441086a22042006470d000b0b2006200220056b2209417c7122076a210402400240200120056a220841037122010d00200620044f0d0120082101034020062001280200360200200141046a2101200641046a22062004490d000c020b0b410021022003410036020c2003410c6a20017221050240410420016b220a410171450d00200520082d00003a0000410121020b0240200a410271450d00200520026a200820026a2f01003b01000b200820016b21022001410374210b200328020c210502400240200641046a2004490d002006210c0c010b4100200b6b411871210d034020062005200b76200241046a22022802002205200d7472360200200641086a210a200641046a220c2106200a2004490d000b0b41002106200341003a0008200341003a00060240024020014101470d00200341086a210d410021014100210a4100210e0c010b200241056a2d0000210a2003200241046a2d000022013a0008200a410874210a4102210e200341066a210d0b02402008410171450d00200d200241046a200e6a2d00003a000020032d0006411074210620032d000821010b200c200a200672200141ff0171724100200b6b411871742005200b76723602000b20094103712102200820076a21010b02402004200420026a22064f0d002002417f6a2109024020024107712208450d000340200420012d00003a0000200141016a2101200441016a21042008417f6a22080d000b0b20094107490d000340200420012d00003a0000200441016a200141016a2d00003a0000200441026a200141026a2d00003a0000200441036a200141036a2d00003a0000200441046a200141046a2d00003a0000200441056a200141056a2d00003a0000200441066a200141066a2d00003a0000200441076a200141076a2d00003a0000200141086a2101200441086a22042006470d000b0b20000b0e00200020012002108c808080000baa0301057f02400240200241104f0d00200021030c010b024020002000410020006b41037122046a22054f0d002004417f6a21062000210302402004450d0020042107200021030340200320013a0000200341016a21032007417f6a22070d000b0b20064107490d000340200320013a0000200341076a20013a0000200341066a20013a0000200341056a20013a0000200341046a20013a0000200341036a20013a0000200341026a20013a0000200341016a20013a0000200341086a22032005470d000b0b024020052005200220046b2202417c716a22034f0d00200141ff017141818284086c2107034020052007360200200541046a22052003490d000b0b200241037121020b02402003200320026a22074f0d002002417f6a2104024020024107712205450d000340200320013a0000200341016a21032005417f6a22050d000b0b20044107490d000340200320013a0000200341076a20013a0000200341066a20013a0000200341056a20013a0000200341046a20013a0000200341036a20013a0000200341026a20013a0000200341016a20013a0000200341086a22032007470d000b0b20000b0bf0050100418080c0000be605436f756e7465727061727420657363726f772049442066726f6d206d656d6f3a5374617274696e6720636f756e746572706172742073656375726974792076616c69646174696f6e436f756e74657270617274205741534d2076616c69646174696f6e206661696c6564202d206e6f742061746f6d69635f7377617032436f756e74657270617274205741534d2076616c69646174696f6e20706173736564436f756e746572706172742064617461206669656c643a416c6c20636f756e746572706172742073656375726974792076616c69646174696f6e732070617373656443757272656e742064657374696e6174696f6e3a457870656374656420636f756e74657270617274206163636f756e743a43757272656e74206163636f756e743a457870656374656420636f756e746572706172742064657374696e6174696f6e3a4572726f722067657474696e6720636f756e7465727061727420657363726f772064657374696e6174696f6e3a4572726f722067657474696e6720636f756e7465727061727420657363726f77206163636f756e743a4572726f722067657474696e672063757272656e7420657363726f772064657374696e6174696f6e3a4572726f722067657474696e672063757272656e7420657363726f77206163636f756e743a436f756e746572706172742064617461206669656c6420696e76616c6964206c656e6774682c206578706563746564203332206f722033362062797465732c20676f743a4572726f722067657474696e6720636f756e7465727061727420646174613a4572726f722067657474696e6720636f756e746572706172742046696e69736846756e6374696f6e3a4661696c656420746f20636163686520636f756e7465727061727420657363726f772c206572726f723a4d656d6f20746f6f2073686f72742c206578706563746564206174206c656173742033322062797465732c20676f743a4572726f722067657474696e67206669727374206d656d6f3a00ea05046e616d6500121161746f6d69635f73776170312e7761736d01ae050f00435f5a4e31367872706c5f7761736d5f7374646c696234686f737431396765745f74785f6e65737465645f6669656c64313768646634393532666466396237363663314501385f5a4e31367872706c5f7761736d5f7374646c696234686f73743974726163655f6e756d313768303934346339333163623931343134384502345f5a4e31367872706c5f7761736d5f7374646c696234686f7374357472616365313768303233343831343864626432346237384503405f5a4e31367872706c5f7761736d5f7374646c696234686f7374313663616368655f6c65646765725f6f626a313768343130663233373063303338353763664504445f5a4e31367872706c5f7761736d5f7374646c696234686f737432306765745f6c65646765725f6f626a5f6669656c643137686130613938316439303539363335646445054c5f5a4e31367872706c5f7761736d5f7374646c696234686f737432386765745f63757272656e745f6c65646765725f6f626a5f6669656c643137683037363136346339643734373238343145060e6765745f66697273745f6d656d6f07435f5a4e31367872706c5f7761736d5f7374646c696234636f7265376c6f6361746f72374c6f6361746f72347061636b3137686164373430643865326466656162356645080666696e69736809425f5a4e34636f726535736c69636535696e6465783234736c6963655f656e645f696e6465785f6c656e5f6661696c31376836303366356135396430323661386662450a305f5a4e34636f72653970616e69636b696e673970616e69635f666d7431376834663161353433383262653664353066450b066d656d636d700c355f5a4e3137636f6d70696c65725f6275696c74696e73336d656d366d656d63707931376835316133663261383564383239376237450d066d656d6370790e066d656d736574071201000f5f5f737461636b5f706f696e746572090a0100072e726f64617461004d0970726f64756365727302086c616e6775616765010452757374000c70726f6365737365642d6279010572757374631d312e38392e30202832393438333838336520323032352d30382d30342900220f7461726765745f6665617475726573012b0f6d757461626c652d676c6f62616c73",
        atomic_swap2:
          "0061736d0100000001360960037f7f7f017f60037f7f7e017f60057f7f7f7f7f017f6000017f60047f7f7f7f017f60027f7f017f60017f0060027f7f0060000002c4010708686f73745f6c69621c6765745f63757272656e745f6c65646765725f6f626a5f6669656c64000008686f73745f6c69620974726163655f6e756d000108686f73745f6c6962057472616365000208686f73745f6c6962166765745f706172656e745f6c65646765725f74696d65000308686f73745f6c69621063616368655f6c65646765725f6f626a000008686f73745f6c6962146765745f6c65646765725f6f626a5f6669656c64000408686f73745f6c69620b7570646174655f646174610005030a090306070708000000000405017001010105030100110619037f01418080c0000b7f0041d48ac0000b7f0041e08ac0000b072e04066d656d6f727902000666696e69736800070a5f5f646174615f656e6403010b5f5f686561705f6261736503020a921f09ee1101067f2380808080004190c1066b220024808080800020004190216a4100418020108f808080001a02400240419b801c20004190216a4180201080808080002201417f4a0d0041ca89c0800041222001ac1081808080001a0c010b2000280290212102200041046a41046a20004190216a41046a41fc1f108e808080001a200020023602042000200136028420418080c0800041142001ad1081808080001a024002400240024002400240024002400240024002400240024020002802842022014181204f0d00419480c08000410d200041046a200141011082808080001a024020002802842022014121490d0020014124490d0420004190216a41186a200041046a41186a29020037030020004190216a41106a200041046a41106a29020037030020004190216a41086a200041046a41086a290200370300200020002902043703902141a180c08000412420004190216a412041011082808080001a2000280284202201417c6a210220014104490d0220014180204b0d0341c580c080004116200041046a20026a2800002202ad1081808080001a02401083808080002201417f4a0d0041d181c0800041212001ac1081808080001a0c0f0b41db80c0800041142001ad1081808080001a024020012002490d0041ef80c08000413042001081808080001a0c0e0b419f81c08000413242001081808080001a410121010c0e0b024020014120460d00419089c08000413a2001ad1081808080001a0c0d0b20004188206a41186a200041046a41186a29020037030020004188206a41106a200041046a41106a29020037030020004188206a41086a200041046a41086a290200370300200020002902043703882041b682c08000411a20004188206a412041011082808080001a4100210120004188206a4120410010848080800022024100480d0441d082c08000412942001081808080001a20004190216a41004180a006108f808080001a0240200241a0801c20004190216a4180a006108580808000220141004e0d0041c288c08000412a2001ac1081808080001a200121010c0e0b20014181a0064f0d050240024020014108490d002000280290214180c2cdeb06470d002000280294214101470d0020014180786a41819806490d010b41f982c08000413642001081808080001a0c0d0b41af83c08000412342001081808080001a200041a0216a2203410036020020004198216a220442003703002000420037039021024020024181802020004190216a411410858080800022014114460d00419f88c0800041232001417f2001417f481b2201ac1081808080001a0c0e0b200041ac206a41026a20002d0092213a000020002000290097213703e820200020004190216a410c6a22052900003700ed20200041ac206a410c6a20002900ed20370000200020002f0190213b01ac2020002000280093213600af20200020002903e8203700b32020034100360200200442003703002000420037039021024020024183802020004190216a411410858080800022014114460d0041f887c0800041272001417f2001417f481b2201ac1081808080001a0c0e0b200041c0206a41026a20002d0092213a000020002000290097213703e820200020052900003700ed20200041c0206a410c6a20002900ed20370000200020002f0190213b01c02020002000280093213600c320200020002903e8203700c720200041a0216a2202410036020020004198216a22034200370300200042003703902102404181802020004190216a411410808080800022014114460d0041d387c0800041252001417f2001417f481b2201ac1081808080001a0c0e0b200041d4206a41026a20002d0092213a000020002000290097213703e820200020004190216a410c6a22042900003700ed20200041d4206a410c6a20002900ed20370000200020002f0190213b01d42020002000280093213600d720200020002903e8203700db202002410036020020034200370300200042003703902102404183802020004190216a411410808080800022014114460d0041aa87c0800041292001417f2001417f481b2201ac1081808080001a0c0e0b200041e8206a41026a20002d0092213a00002000200029009721370380212000200429000037008521200041e8206a410c6a200029008521370000200020002f0190213b01e82020002000280093213600eb2020002000290380213700ef20200041ac206a200041e8206a4114108c808080000d06200041c0206a200041d4206a4114108c808080000d0741d283c08000412c42001081808080001a20004190216a108880808000024020002802902122014102470d0041ba85c08000411a2000280294212201ac1081808080001a0c0e0b2001410171450d0841a584c08000411b2000280294212202ad1081808080001a200028028420220141046a22034180204b0d0b2001417c4f0d09200041046a20016a2002360000200020002802842041046a22013602842041c084c0800041142001ad1081808080001a20002802842022014181204f0d0a41d484c08000410d200041046a200141011082808080001a20004190216a200041046a418420108e808080001a024020004190216a2000280290411086808080002201417f4a0d00418185c08000411b2001411f752001712201ac1081808080001a0c0e0b41e184c08000412042001081808080001a0c0c0b2001418020108980808000000b20022001108a80808000000b2001418020108980808000000b41f281c0800041c4002001ad1081808080001a0c080b41ec88c0800041242002ac1081808080001a0c080b20014180a006108980808000000b41c186c080004115200041ac206a411441011082808080001a41d686c08000411b200041e8206a411441011082808080001a41f186c08000413942001081808080001a0c050b41d485c080004119200041c0206a411441011082808080001a41ed85c080004117200041d4206a411441011082808080001a418486c08000413d42001081808080001a0c040b41fe83c08000412742001081808080001a0c030b20012003108a80808000000b2001418020108980808000000b419c85c08000411e42001081808080001a0b410021010b20004190c1066a24808080800020010bc60101027f23808080800041106b22012480808080002001410036020c02400240024041a480082001410c6a41041080808080002202417e460d0020024104470d012000200128020c360204200041013602000c020b200041003602000c010b02402002417f4a0d0041ec89c0800041172002ac1081808080001a20004102360200200020023602040c010b41838ac08000413142041081808080001a41b48ac0800041202002ad1081808080001a20004282808080b07e3702000b200141106a2480808080000b0900108b80808000000b0900108b80808000000b0300000b4a01037f4100210302402002450d000240034020002d0000220420012d00002205470d01200041016a2100200141016a21012002417f6a2202450d020c000b0b200420056b21030b20030bb907010c7f23808080800041106b210302400240200241104f0d00200021040c010b024020002000410020006b41037122056a22064f0d002005417f6a2107200021042001210802402005450d002005210920002104200121080340200420082d00003a0000200841016a2108200441016a21042009417f6a22090d000b0b20074107490d000340200420082d00003a0000200441016a200841016a2d00003a0000200441026a200841026a2d00003a0000200441036a200841036a2d00003a0000200441046a200841046a2d00003a0000200441056a200841056a2d00003a0000200441066a200841066a2d00003a0000200441076a200841076a2d00003a0000200841086a2108200441086a22042006470d000b0b2006200220056b2209417c7122076a210402400240200120056a220841037122010d00200620044f0d0120082101034020062001280200360200200141046a2101200641046a22062004490d000c020b0b410021022003410036020c2003410c6a20017221050240410420016b220a410171450d00200520082d00003a0000410121020b0240200a410271450d00200520026a200820026a2f01003b01000b200820016b21022001410374210b200328020c210502400240200641046a2004490d002006210c0c010b4100200b6b411871210d034020062005200b76200241046a22022802002205200d7472360200200641086a210a200641046a220c2106200a2004490d000b0b41002106200341003a0008200341003a00060240024020014101470d00200341086a210d410021014100210a4100210e0c010b200241056a2d0000210a2003200241046a2d000022013a0008200a410874210a4102210e200341066a210d0b02402008410171450d00200d200241046a200e6a2d00003a000020032d0006411074210620032d000821010b200c200a200672200141ff0171724100200b6b411871742005200b76723602000b20094103712102200820076a21010b02402004200420026a22064f0d002002417f6a2109024020024107712208450d000340200420012d00003a0000200141016a2101200441016a21042008417f6a22080d000b0b20094107490d000340200420012d00003a0000200441016a200141016a2d00003a0000200441026a200141026a2d00003a0000200441036a200141036a2d00003a0000200441046a200141046a2d00003a0000200441056a200141056a2d00003a0000200441066a200141066a2d00003a0000200441076a200141076a2d00003a0000200141086a2101200441086a22042006470d000b0b20000b0e00200020012002108d808080000baa0301057f02400240200241104f0d00200021030c010b024020002000410020006b41037122046a22054f0d002004417f6a21062000210302402004450d0020042107200021030340200320013a0000200341016a21032007417f6a22070d000b0b20064107490d000340200320013a0000200341076a20013a0000200341066a20013a0000200341056a20013a0000200341046a20013a0000200341036a20013a0000200341026a20013a0000200341016a20013a0000200341086a22032005470d000b0b024020052005200220046b2202417c716a22034f0d00200141ff017141818284086c2107034020052007360200200541046a22052003490d000b0b200241037121020b02402003200320026a22074f0d002002417f6a2104024020024107712205450d000340200320013a0000200341016a21032005417f6a22050d000b0b20044107490d000340200320013a0000200341076a20013a0000200341066a20013a0000200341056a20013a0000200341046a20013a0000200341036a20013a0000200341026a20013a0000200341016a20013a0000200341086a22032007470d000b0b20000b0bde0a0100418080c0000bd40a43757272656e742064617461206c656e6774683a43757272656e7420646174613a466972737420657363726f772049442066726f6d2064617461202850686173652032293a4578747261637465642043616e63656c41667465723a43757272656e74206c65646765722074696d653a41746f6d6963207377617020617474656d707465642061667465722043616e63656c4166746572202d206661696c656441746f6d69632073776170206578656375746564206265666f72652043616e63656c4166746572202d2073756363657373214572726f722067657474696e6720706172656e74206c65646765722074696d653a496e76616c69642064617461206c656e67746820666f72207365636f6e642072756e2c206578706563746564206174206c656173742033362062797465732c20676f743a466972737420657363726f772049442066726f6d20646174613a5374617274696e6720666972737420657363726f772073656375726974792076616c69646174696f6e466972737420657363726f77205741534d2076616c69646174696f6e206661696c6564202d206e6f742061746f6d69635f7377617031466972737420657363726f77205741534d2076616c69646174696f6e20706173736564416c6c20666972737420657363726f772073656375726974792076616c69646174696f6e732070617373656443757272656e7420657363726f7720686173206e6f2043616e63656c4166746572206669656c6443757272656e7420657363726f772043616e63656c41667465723a557064617465642064617461206c656e6774683a5570646174656420646174613a5375636365737366756c6c79207570646174656420657363726f7720646174614572726f72207570646174696e6720657363726f7720646174613a4461746120776f756c6420657863656564206d6178696d756d2073697a654572726f722067657474696e672043616e63656c41667465723a466972737420657363726f772064657374696e6174696f6e3a43757272656e7420657363726f77206163636f756e743a4163636f756e7420726576657273616c2076616c69646174696f6e206661696c6564202d2064657374696e6174696f6e7320646f6e2774206d61746368466972737420657363726f77206163636f756e743a43757272656e7420657363726f772064657374696e6174696f6e3a4163636f756e7420726576657273616c2076616c69646174696f6e206661696c6564202d206163636f756e747320646f6e2774206d617463684572726f722067657474696e672063757272656e7420657363726f772064657374696e6174696f6e3a4572726f722067657474696e672063757272656e7420657363726f77206163636f756e743a4572726f722067657474696e6720666972737420657363726f772064657374696e6174696f6e3a4572726f722067657474696e6720666972737420657363726f77206163636f756e743a4572726f722067657474696e6720666972737420657363726f772046696e69736846756e6374696f6e3a4661696c656420746f20636163686520666972737420657363726f772c206572726f723a496e76616c69642064617461206c656e67746820666f722066697273742072756e2c2065787065637465642033322062797465732c20676f743a4572726f722067657474696e672063757272656e7420657363726f7720646174613a456e636f756e7465726564206572726f725f636f64653a427974652061727261792077617320657870656374656420746f20686176652074686973206d616e792062797465733a2042797465206172726179206861642074686973206d616e792062797465733a2000a407046e616d6500121161746f6d69635f73776170322e7761736d01e80610004c5f5a4e31367872706c5f7761736d5f7374646c696234686f737432386765745f63757272656e745f6c65646765725f6f626a5f6669656c64313768303736313634633964373437323834314501385f5a4e31367872706c5f7761736d5f7374646c696234686f73743974726163655f6e756d313768303934346339333163623931343134384502345f5a4e31367872706c5f7761736d5f7374646c696234686f7374357472616365313768303233343831343864626432346237384503465f5a4e31367872706c5f7761736d5f7374646c696234686f737432326765745f706172656e745f6c65646765725f74696d65313768383531303464663937383330656464374504405f5a4e31367872706c5f7761736d5f7374646c696234686f7374313663616368655f6c65646765725f6f626a313768343130663233373063303338353763664505445f5a4e31367872706c5f7761736d5f7374646c696234686f737432306765745f6c65646765725f6f626a5f6669656c643137686130613938316439303539363335646445063b5f5a4e31367872706c5f7761736d5f7374646c696234686f737431317570646174655f646174613137683736346530333061626430326361393245070666696e697368088a015f5a4e37355f244c54247533322475323024617324753230247872706c5f7761736d5f7374646c69622e2e636f72652e2e6c65646765725f6f626a656374732e2e4669656c644765747465722447542433366765745f66726f6d5f63757272656e745f6c65646765725f6f626a5f6f7074696f6e616c313768376530353865373161383565316261634509425f5a4e34636f726535736c69636535696e6465783234736c6963655f656e645f696e6465785f6c656e5f6661696c31376836303366356135396430323661386662450a405f5a4e34636f726535736c69636535696e6465783232736c6963655f696e6465785f6f726465725f6661696c31376830613037316333393134323561666437450b305f5a4e34636f72653970616e69636b696e673970616e69635f666d7431376834663161353433383262653664353066450c066d656d636d700d355f5a4e3137636f6d70696c65725f6275696c74696e73336d656d366d656d63707931376835316133663261383564383239376237450e066d656d6370790f066d656d736574071201000f5f5f737461636b5f706f696e746572090a0100072e726f64617461004d0970726f64756365727302086c616e6775616765010452757374000c70726f6365737365642d6279010572757374631d312e38392e30202832393438333838336520323032352d30382d30342900220f7461726765745f6665617475726573012b0f6d757461626c652d676c6f62616c73",
        hello_world:
          "0061736d01000000010e0260057f7f7f7f7f017f6000017f02120108686f73745f6c696205747261636500000302010105030100110619037f01418080c0000b7f00418c80c0000b7f00419080c0000b072e04066d656d6f727902000666696e69736800010a5f5f646174615f656e6403010b5f5f686561705f6261736503020a1b011900418080c08000410c4100410041001080808080001a41010b0b150100418080c0000b0c48656c6c6f20576f726c64210079046e616d6500111068656c6c6f5f776f726c642e7761736d013f0200345f5a4e31367872706c5f7761736d5f7374646c696234686f73743574726163653137683032333438313438646264323462373845010666696e697368071201000f5f5f737461636b5f706f696e746572090a0100072e726f64617461004d0970726f64756365727302086c616e6775616765010452757374000c70726f6365737365642d6279010572757374631d312e38392e30202832393438333838336520323032352d30382d30342900220f7461726765745f6665617475726573012b0f6d757461626c652d676c6f62616c73",
        kyc: "0061736d0100000001280560037f7f7f017f60037f7f7e017f60087f7f7f7f7f7f7f7f017f60057f7f7f7f7f017f6000017f0288010508686f73745f6c69621c6765745f63757272656e745f6c65646765725f6f626a5f6669656c64000008686f73745f6c69620974726163655f6e756d000108686f73745f6c69621163726564656e7469616c5f6b65796c6574000208686f73745f6c6962057472616365000308686f73745f6c69621063616368655f6c65646765725f6f626a00000302010405030100110619037f01418080c0000b7f0041e080c0000b7f0041e080c0000b072e04066d656d6f727902000666696e69736800050a5f5f646174615f656e6403010b5f5f686561705f6261736503020ac00401bd0402047f027e2380808080004180016b2200248080808000200041f0006a22014100360200200041e8006a22024200370300200042003703600240024041838020200041e0006a411410808080800022034114460d0041c780c0800041192003417f2003417f481b2203ac1081808080001a0c010b2000410c6a41026a20002d00623a0000200020002900673703402000200041e0006a410c6a2900003700452000410c6a410c6a2000290045370000200020002f01603b010c2000200028006336000f20002000290340370013200041e0006a41186a420037030020014200370300200242003703002000420037036002402000410c6a41142000410c6a4114418080c080004112200041e0006a412010828080800022034120460d0041a880c08000411f2003417f2003417f481b2203ac1081808080001a0c010b200041c0006a41026a20002d00623a0000200041286a200041e0006a410f6a2900002204370300200041306a200041e0006a41176a2900002205370300200041206a41186a200041e0006a411f6a2d000022033a0000200041c0006a410f6a2004370000200041c0006a41176a2005370000200041c0006a411f6a20033a0000200020002f01603b0140200020002900672204370320200020002800633600432000200437004741012103419280c08000410b200041c0006a412041011083808080001a200041c0006a41204100108480808000220141004e0d00419d80c08000410b2001ac1081808080001a410021030b20004180016a24808080800020030b0b690100418080c0000b607465726d73616e64636f6e646974696f6e73637265645f6b65796c65744341434845204552524f524572726f722067657474696e672063726564656e7469616c206b65796c65744572726f722067657474696e672064657374696e6174696f6e00ff02046e616d650009086b79632e7761736d01cc0206004c5f5a4e31367872706c5f7761736d5f7374646c696234686f737432386765745f63757272656e745f6c65646765725f6f626a5f6669656c64313768303736313634633964373437323834314501385f5a4e31367872706c5f7761736d5f7374646c696234686f73743974726163655f6e756d313768303934346339333163623931343134384502415f5a4e31367872706c5f7761736d5f7374646c696234686f7374313763726564656e7469616c5f6b65796c6574313768343862393564306430343931396337614503345f5a4e31367872706c5f7761736d5f7374646c696234686f7374357472616365313768303233343831343864626432346237384504405f5a4e31367872706c5f7761736d5f7374646c696234686f7374313663616368655f6c65646765725f6f626a3137683431306632333730633033383537636645050666696e697368071201000f5f5f737461636b5f706f696e746572090a0100072e726f64617461004d0970726f64756365727302086c616e6775616765010452757374000c70726f6365737365642d6279010572757374631d312e38392e30202832393438333838336520323032352d30382d30342900220f7461726765745f6665617475726573012b0f6d757461626c652d676c6f62616c73",
        ledger_sqn:
          "0061736d01000000010f036000017f60037f7f7e017f60000002300208686f73745f6c69620e6765745f6c65646765725f73716e000008686f73745f6c69620974726163655f6e756d0001030302000205030100110619037f01418080c0000b7f00419a80c0000b7f0041a080c0000b072e04066d656d6f727902000666696e69736800020a5f5f646174615f656e6403010b5f5f686561705f6261736503020a4a024401017f02401080808080002200417f4a0d00418080c08000410b2000ac1081808080001a108380808000000b418b80c08000410f2000ad1081808080001a200041044b0b0300000b0b230100418080c0000b1a6572726f725f636f64653d4c65646765722053657175656e636500ef01046e616d6500100f6c65646765725f73716e2e7761736d01b50104003e5f5a4e31367872706c5f7761736d5f7374646c696234686f737431346765745f6c65646765725f73716e313768396630623266366265626132363938664501385f5a4e31367872706c5f7761736d5f7374646c696234686f73743974726163655f6e756d3137683039343463393331636239313431343845020666696e69736803305f5a4e34636f72653970616e69636b696e673970616e69635f666d743137683466316135343338326265366435306645071201000f5f5f737461636b5f706f696e746572090a0100072e726f64617461004d0970726f64756365727302086c616e6775616765010452757374000c70726f6365737365642d6279010572757374631d312e38392e30202832393438333838336520323032352d30382d30342900220f7461726765745f6665617475726573012b0f6d757461626c652d676c6f62616c73",
        nft_owner:
          "0061736d0100000001370860047f7f7f7f017f60037f7f7e017f60057f7f7f7f7f017f60037f7f7f017f60067f7f7f7f7f7f017f60017f0060027f7f006000017f0281010508686f73745f6c6962136765745f74785f6e65737465645f6669656c64000008686f73745f6c69620974726163655f6e756d000108686f73745f6c6962057472616365000208686f73745f6c69621c6765745f63757272656e745f6c65646765725f6f626a5f6669656c64000308686f73745f6c6962076765745f6e667400040307060506070303030405017001010105030100110619037f01418080c0000b7f0041e580c0000b7f0041f080c0000b073f05066d656d6f727902000e6765745f66697273745f6d656d6f00050666696e69736800070a5f5f646174615f656e6403010b5f5f686561705f6261736503020ac21106e00101037f23808080800041d0206b2201248080808000410021022001410c6a4100418020108a808080001a2001418c206a410041c400108a808080001a2001418c206a4189803c1086808080002001418c206a41001086808080002001418c206a418d801c108680808000024002402001418c206a20012802cc202001410c6a418020108080808000220341004a0d000240024020030d002000417f3602040c010b200020033602040b410121020c010b200041026a2001410c6a4180201089808080001a200041013a00010b200020023a0000200141d0206a2480808080000b6601027f23808080800041106b210202402000280240220341436a41bf7f490d002002200136020c410021010340200341c0004f0d01200020036a2002410c6a20016a2d00003a00002000200028024041016a2203360240200141016a22014104470d000b0b0b800401037f23808080800041d0c0006b220024808080800020004180206a1085808080000240024020002d0080204101470d0041cc80c0800041192000280284202201ac1081808080001a0c010b4100210120002d008120410171450d00200020004180206a41027241802010898080800022014188c0006a41186a200141186a29000037030020014188c0006a41106a200141106a29000037030020014188c0006a41086a200141086a2900003703002001200129000037038840418080c08000411120014188c0006a412041011082808080001a20014180206a41106a410036020020014180206a41086a4200370300200142003703802002404183802020014180206a411410838080800022024114460d0041a380c0800041292002417f2002417f481b2201ac1081808080001a0c010b200141acc0006a41026a20012d0082203a000020012001290087203703c040200120014180206a410c6a2900003700c540200141acc0006a410c6a20012900c540370000200120012f0180203b01ac4020012001280083203600af40200120012903c0403700b34020014180206a4100418020108a808080001a0240200141acc0006a411420014188c0006a412020014180206a41802010848080800022014101480d00410121010c010b419180c0800041122001ac1081808080001a0b200041d0c0006a24808080800020010bb907010c7f23808080800041106b210302400240200241104f0d00200021040c010b024020002000410020006b41037122056a22064f0d002005417f6a2107200021042001210802402005450d002005210920002104200121080340200420082d00003a0000200841016a2108200441016a21042009417f6a22090d000b0b20074107490d000340200420082d00003a0000200441016a200841016a2d00003a0000200441026a200841026a2d00003a0000200441036a200841036a2d00003a0000200441046a200841046a2d00003a0000200441056a200841056a2d00003a0000200441066a200841066a2d00003a0000200441076a200841076a2d00003a0000200841086a2108200441086a22042006470d000b0b2006200220056b2209417c7122076a210402400240200120056a220841037122010d00200620044f0d0120082101034020062001280200360200200141046a2101200641046a22062004490d000c020b0b410021022003410036020c2003410c6a20017221050240410420016b220a410171450d00200520082d00003a0000410121020b0240200a410271450d00200520026a200820026a2f01003b01000b200820016b21022001410374210b200328020c210502400240200641046a2004490d002006210c0c010b4100200b6b411871210d034020062005200b76200241046a22022802002205200d7472360200200641086a210a200641046a220c2106200a2004490d000b0b41002106200341003a0008200341003a00060240024020014101470d00200341086a210d410021014100210a4100210e0c010b200241056a2d0000210a2003200241046a2d000022013a0008200a410874210a4102210e200341066a210d0b02402008410171450d00200d200241046a200e6a2d00003a000020032d0006411074210620032d000821010b200c200a200672200141ff0171724100200b6b411871742005200b76723602000b20094103712102200820076a21010b02402004200420026a22064f0d002002417f6a2109024020024107712208450d000340200420012d00003a0000200141016a2101200441016a21042008417f6a22080d000b0b20094107490d000340200420012d00003a0000200441016a200141016a2d00003a0000200441026a200141026a2d00003a0000200441036a200141036a2d00003a0000200441046a200141046a2d00003a0000200441056a200141056a2d00003a0000200441066a200141066a2d00003a0000200441076a200141076a2d00003a0000200141086a2101200441086a22042006470d000b0b20000b0e002000200120021088808080000baa0301057f02400240200241104f0d00200021030c010b024020002000410020006b41037122046a22054f0d002004417f6a21062000210302402004450d0020042107200021030340200320013a0000200341016a21032007417f6a22070d000b0b20064107490d000340200320013a0000200341076a20013a0000200341066a20013a0000200341056a20013a0000200341046a20013a0000200341036a20013a0000200341026a20013a0000200341016a20013a0000200341086a22032005470d000b0b024020052005200220046b2202417c716a22034f0d00200141ff017141818284086c2107034020052007360200200541046a22052003490d000b0b200241037121020b02402003200320026a22074f0d002002417f6a2104024020024107712205450d000340200320013a0000200341016a21032005417f6a22050d000b0b20044107490d000340200320013a0000200341076a20013a0000200341066a20013a0000200341056a20013a0000200341046a20013a0000200341036a20013a0000200341026a20013a0000200341016a20013a0000200341086a22032007470d000b0b20000b0b6e0100418080c0000b654e46542049442066726f6d206d656d6f3a4572726f722067657474696e67204e46543a4572726f722067657474696e672063757272656e74206c65646765722064657374696e6174696f6e3a4572726f722067657474696e67206669727374206d656d6f3a009904046e616d65000f0e6e66745f6f776e65722e7761736d01e0030b00435f5a4e31367872706c5f7761736d5f7374646c696234686f737431396765745f74785f6e65737465645f6669656c64313768646634393532666466396237363663314501385f5a4e31367872706c5f7761736d5f7374646c696234686f73743974726163655f6e756d313768303934346339333163623931343134384502345f5a4e31367872706c5f7761736d5f7374646c696234686f73743574726163653137683032333438313438646264323462373845034c5f5a4e31367872706c5f7761736d5f7374646c696234686f737432386765745f63757272656e745f6c65646765725f6f626a5f6669656c64313768303736313634633964373437323834314504365f5a4e31367872706c5f7761736d5f7374646c696234686f7374376765745f6e66743137683364306331323065353236623064393545050e6765745f66697273745f6d656d6f06435f5a4e31367872706c5f7761736d5f7374646c696234636f7265376c6f6361746f72374c6f6361746f72347061636b3137686164373430643865326466656162356645070666696e69736808355f5a4e3137636f6d70696c65725f6275696c74696e73336d656d366d656d637079313768353161336632613835643832393762374509066d656d6370790a066d656d736574071201000f5f5f737461636b5f706f696e746572090a0100072e726f64617461004d0970726f64756365727302086c616e6775616765010452757374000c70726f6365737365642d6279010572757374631d312e38392e30202832393438333838336520323032352d30382d30342900220f7461726765745f6665617475726573012b0f6d757461626c652d676c6f62616c73",
        notary:
          "0061736d0100000001130360037f7f7f017f60037f7f7e017f6000017f022e0208686f73745f6c69620c6765745f74785f6669656c64000008686f73745f6c69620974726163655f6e756d0001030302020005030100110619037f01418080c0000b7f0041ac80c0000b7f0041b080c0000b072e04066d656d6f727902000666696e69736800020a5f5f646174615f656e6403010b5f5f686561705f6261736503020ab40202e60101027f23808080800041c0006b2200248080808000200041386a4100360200200041306a4200370300200042003703280240024041818020200041286a411410808080800022014114460d00419480c0800041182001417f2001417f481b2201ac1081808080001a0c010b200041066a20002d002a3a00002000200029002f3703182000200041286a410c6a29000037001d200041046a410c6a200029001d370000200020002f01283b01042000200028002b3600072000200029031837000b200041046a418080c0800041141083808080004521010b200041c0006a24808080800020010b4a01037f4100210302402002450d000240034020002d0000220420012d00002205470d01200041016a2100200141016a21012002417f6a2202450d020c000b0b200420056b21030b20030b0b350100418080c0000b2cb5f762798a53d543a014caf8b297cff8f2f937e84572726f7220696e204e6f7461727920636f6e747261637400bf01046e616d65000c0b6e6f746172792e7761736d01890104003c5f5a4e31367872706c5f7761736d5f7374646c696234686f737431326765745f74785f6669656c64313768313363616561393264326134383065664501385f5a4e31367872706c5f7761736d5f7374646c696234686f73743974726163655f6e756d3137683039343463393331636239313431343845020666696e69736803066d656d636d70071201000f5f5f737461636b5f706f696e746572090a0100072e726f64617461004d0970726f64756365727302086c616e6775616765010452757374000c70726f6365737365642d6279010572757374631d312e38392e30202832393438333838336520323032352d30382d30342900220f7461726765745f6665617475726573012b0f6d757461626c652d676c6f62616c73",
        oracle:
          "0061736d0100000001210560057f7f7f7f7f017f60037f7f7e017f60037f7f7f017f6000017f60027f7f000283010508686f73745f6c69620d6f7261636c655f6b65796c6574000008686f73745f6c6962057472616365000008686f73745f6c69620974726163655f6e756d000108686f73745f6c69621063616368655f6c65646765725f6f626a000208686f73745f6c69621b6765745f6c65646765725f6f626a5f6e65737465645f6669656c64000003040303040205030100110619037f01418080c0000b7f00418481c0000b7f00419081c0000b072e04066d656d6f727902000666696e69736800050a5f5f646174615f656e6403010b5f5f686561705f6261736503020a910803fb0303037f017e017f2380808080004190016b2200248080808000200041d8006a4200370300200041d0006a4200370300200041c0006a41086a42003703002000420037034002400240419980c0800041144101200041c0006a412010808080800022014120460d0041ad80c08000412b419980c08000411441011081808080001a41d880c08000412c42011082808080001a2001417f2001417f481b21020c010b200041026a20002d00423a0000200041206a41086a200041c0006a410f6a29000022033703002000410f6a2003370000200041176a200041c0006a41176a2900003700002000411f6a200041c0006a411f6a2d00003a0000200020002f01403b010020002000280043360003200020002900473700074100210220004120410010838080800022044100480d0041002101200041c0006a410041c4001087808080001a200041c0006a4198803c108680808000200041c0006a4100108680808000200041c0006a4197800c10868080800042002103200042003703880102402004200041c0006a20002802800120004188016a41081084808080002202417f4a0d00418080c0800041192002ac1082808080001a0c010b200020002903880137032003402003420886200041206a20016a310000842103200141016a22014108470d000b200342015621020b20004190016a24808080800020020b6601027f23808080800041106b210202402000280240220341436a41bf7f490d002002200136020c410021010340200341c0004f0d01200020036a2002410c6a20016a2d00003a00002000200028024041016a2203360240200141016a22014104470d000b0b0baa0301057f02400240200241104f0d00200021030c010b024020002000410020006b41037122046a22054f0d002004417f6a21062000210302402004450d0020042107200021030340200320013a0000200341016a21032007417f6a22070d000b0b20064107490d000340200320013a0000200341076a20013a0000200341066a20013a0000200341056a20013a0000200341046a20013a0000200341036a20013a0000200341026a20013a0000200341016a20013a0000200341086a22032005470d000b0b024020052005200220046b2202417c716a22034f0d00200141ff017141818284086c2107034020052007360200200541046a22052003490d000b0b200241037121020b02402003200320026a22074f0d002002417f6a2104024020024107712205450d000340200320013a0000200341016a21032005417f6a22050d000b0b20044107490d000340200320013a0000200341076a20013a0000200341066a20013a0000200341056a20013a0000200341046a20013a0000200341036a20013a0000200341026a20013a0000200341016a20013a0000200341086a22032007470d000b0b20000b0b8e010100418080c0000b84014572726f722067657474696e672061737365745f7072696365b5f762798a53d543a014caf8b297cff8f2f937e84661696c656420746f20676574206f7261636c655f6b65796c657420666f72206163636f756e745f69643d4661696c656420746f20676574206f7261636c655f6b65796c657420666f7220646f63756d656e745f69643d00ca03046e616d65000c0b6f7261636c652e7761736d01940308003d5f5a4e31367872706c5f7761736d5f7374646c696234686f737431336f7261636c655f6b65796c6574313768353730643766383962656663383238664501345f5a4e31367872706c5f7761736d5f7374646c696234686f7374357472616365313768303233343831343864626432346237384502385f5a4e31367872706c5f7761736d5f7374646c696234686f73743974726163655f6e756d313768303934346339333163623931343134384503405f5a4e31367872706c5f7761736d5f7374646c696234686f7374313663616368655f6c65646765725f6f626a3137683431306632333730633033383537636645044b5f5a4e31367872706c5f7761736d5f7374646c696234686f737432376765745f6c65646765725f6f626a5f6e65737465645f6669656c643137683935643131333430646237303634356245050666696e69736806435f5a4e31367872706c5f7761736d5f7374646c696234636f7265376c6f6361746f72374c6f6361746f72347061636b313768616437343064386532646665616235664507066d656d736574071201000f5f5f737461636b5f706f696e746572090a0100072e726f64617461004d0970726f64756365727302086c616e6775616765010452757374000c70726f6365737365642d6279010572757374631d312e38392e30202832393438333838336520323032352d30382d30342900220f7461726765745f6665617475726573012b0f6d757461626c652d676c6f62616c73",
      }
      // Examples that have README files available
      // Auto-generated by embed-wasm.sh
      const EXAMPLES_WITH_README = {
        atomic_swap1:
          "https://github.com/ripple/xrpl-wasm-stdlib/blob/main/examples/smart-escrows/atomic_swap1/README.md",
        atomic_swap2:
          "https://github.com/ripple/xrpl-wasm-stdlib/blob/main/examples/smart-escrows/atomic_swap2/README.md",
        hello_world:
          "https://github.com/ripple/xrpl-wasm-stdlib/blob/main/examples/smart-escrows/hello_world/README.md",
        kyc: "https://github.com/ripple/xrpl-wasm-stdlib/blob/main/examples/smart-escrows/kyc/README.md",
        ledger_sqn:
          "https://github.com/ripple/xrpl-wasm-stdlib/blob/main/examples/smart-escrows/ledger_sqn/README.md",
        nft_owner:
          "https://github.com/ripple/xrpl-wasm-stdlib/blob/main/examples/smart-escrows/nft_owner/README.md",
        notary:
          "https://github.com/ripple/xrpl-wasm-stdlib/blob/main/examples/smart-escrows/notary/README.md",
        oracle:
          "https://github.com/ripple/xrpl-wasm-stdlib/blob/main/examples/smart-escrows/oracle/README.md",
      }

      function updateWasmWarning() {
        const wasmWarning = document.getElementById("wasmWarning")
        if (currentWasm) {
          wasmWarning.classList.add("hidden")
        } else {
          wasmWarning.classList.remove("hidden")
        }
      }

      function updateReadmeLinks(exampleName) {
        const currentWasmReadme = document.getElementById("currentWasmReadme")
        const deployWasmReadme = document.getElementById("deployWasmReadme")

        if (EXAMPLES_WITH_README[exampleName]) {
          const readmeUrl = EXAMPLES_WITH_README[exampleName]
          currentWasmReadme.querySelector("a").href = readmeUrl
          deployWasmReadme.querySelector("a").href = readmeUrl
          currentWasmReadme.classList.remove("hidden")
          deployWasmReadme.classList.remove("hidden")
        } else {
          currentWasmReadme.classList.add("hidden")
          deployWasmReadme.classList.add("hidden")
        }
      }

      async function loadExample(exampleName) {
        try {
          log(`Loading example: ${exampleName}...`)

          const wasmHex = EMBEDDED_WASM[exampleName]
          if (wasmHex) {
            currentWasm = wasmHex
            const wasmInfo = `${exampleName} example (${Math.round(wasmHex.length / 2 / 1024)}KB)`
            document.getElementById("currentWasm").textContent = wasmInfo
            document.getElementById("deployWasmStatus").textContent = wasmInfo
            updateReadmeLinks(exampleName)
            updateWasmWarning()
            log(`‚úÖ Loaded ${exampleName} example from embedded WASM`)
          } else {
            log(`‚ùå ${exampleName} example not available`)
            log(`üí° To add examples, run: ./scripts/embed-wasm.sh`)
            log(`   This will update the UI with the latest built WASM files`)

            currentWasm = null
            const wasmInfo = `${exampleName} example (not embedded - run embed-wasm.sh)`
            document.getElementById("currentWasm").textContent = wasmInfo
            document.getElementById("deployWasmStatus").textContent = wasmInfo
            updateReadmeLinks(exampleName)
            updateWasmWarning()
          }
        } catch (error) {
          logError(`Failed to load example ${exampleName}: ${error.message}`)
        }
      }

      // Account Management
      async function generateAccount() {
        if (!client || !client.isConnected()) {
          logError("Please connect to a network first", "warning")
          return
        }

        // Show loading state
        const generateBtn = document.getElementById("generateBtn")
        const accountLoading = document.getElementById("accountLoading")
        const loadingText = document.getElementById("loadingText")

        generateBtn.disabled = true
        generateBtn.textContent = "Generating..."
        accountLoading.style.display = "block"
        loadingText.textContent = "Generating new account..."

        try {
          log("Generating new account...")
          const wallet = xrpl.Wallet.generate()

          // Fund the wallet
          loadingText.textContent = "Funding account..."
          let fundedWallet
          const network = document.querySelector(
            'input[name="network"]:checked',
          ).value

          if (network.includes("localhost") || network.includes("127.0.0.1")) {
            // Use master wallet for local funding
            const master = xrpl.Wallet.fromSeed(
              "snoPBrXtMeMyMHUVTgbuqAfg1SUTb",
              {
                algorithm: xrpl.ECDSA.secp256k1,
              },
            )

            await client.submitAndWait(
              {
                TransactionType: "Payment",
                Account: "rHb9CJAWyB4rj91VRWn96DkukG4bwdtyTh",
                Amount: xrpl.xrpToDrops(10000),
                Destination: wallet.address,
              },
              { autofill: true, wallet: master },
            )

            fundedWallet = wallet
          } else {
            // Use fundWallet for testnets
            const result = await client.fundWallet(wallet)
            fundedWallet = result.wallet
          }

          accounts.push(fundedWallet)
          await updateAccountsList()
          log(`Generated and funded account: ${fundedWallet.address}`)
          showToast("Account generated and funded successfully!", "success")
        } catch (error) {
          logError(`Failed to generate account: ${error.message}`)
        } finally {
          // Hide loading state
          generateBtn.disabled = false
          generateBtn.textContent = "Generate New Account"
          accountLoading.style.display = "none"
        }
      }

      async function fundSelectedAccount() {
        if (!selectedAccount || !client || !client.isConnected()) {
          logError("Please select an account and connect to network", "warning")
          return
        }

        // Show loading state
        const fundBtn = document.getElementById("fundBtn")
        const originalText = fundBtn.textContent

        fundBtn.disabled = true
        fundBtn.innerHTML = '<div class="spinner-small"></div>Funding...'

        try {
          log(`Funding account ${selectedAccount.address}...`)
          const network = document.querySelector(
            'input[name="network"]:checked',
          ).value

          if (network.includes("localhost") || network.includes("127.0.0.1")) {
            const master = xrpl.Wallet.fromSeed(
              "snoPBrXtMeMyMHUVTgbuqAfg1SUTb",
              {
                algorithm: xrpl.ECDSA.secp256k1,
              },
            )

            await client.submitAndWait(
              {
                TransactionType: "Payment",
                Account: "rHb9CJAWyB4rj91VRWn96DkukG4bwdtyTh",
                Amount: xrpl.xrpToDrops(1000),
                Destination: selectedAccount.address,
              },
              { autofill: true, wallet: master },
            )

            log(`Funded account with 1000 XRP`)
          } else {
            await client.fundWallet(selectedAccount)
            log(`Funded account via testnet faucet`)
          }

          await updateAccountsList()
          showToast("Account funded successfully!", "success")
        } catch (error) {
          logError(`Failed to fund account: ${error.message}`)
        } finally {
          // Restore button state
          fundBtn.disabled = false
          fundBtn.textContent = originalText
        }
      }

      async function updateAccountsList() {
        const accountsList = document.getElementById("accountsList")
        const fundBtn = document.getElementById("fundBtn")

        if (accounts.length === 0) {
          accountsList.innerHTML = `
                    <div class="empty-state">
                        No accounts loaded. Generate or load accounts to get started.
                    </div>
                `
          fundBtn.style.display = "none"
          return
        }

        // Show the fund button when there are accounts
        fundBtn.style.display = "inline-block"

        let html = ""
        for (let i = 0; i < accounts.length; i++) {
          const account = accounts[i]
          let balance = "Unknown"

          if (client && client.isConnected()) {
            try {
              const accountInfo = await client.request({
                command: "account_info",
                account: account.address,
              })
              balance = `${xrpl.dropsToXrp(accountInfo.result.account_data.Balance)} XRP`
            } catch (e) {
              balance = "Not funded"
            }
          }

          html += `
                    <div class="account-item ${selectedAccount === account ? "selected" : ""}" onclick="selectAccount(${i})">
                        <div class="item-header">
                            <div>
                                <strong>Account ${i + 1}</strong>
                                <div class="account-balance">${balance}</div>
                            </div>
                            <button class="btn btn-small" onclick="copyToClipboard('${account.address}'); event.stopPropagation();" title="Copy address">üìã</button>
                        </div>
                        <div class="account-address">${account.address}</div>
                    </div>
                `
        }

        accountsList.innerHTML = html

        // Update dropdowns
        updateAccountDropdowns()
        await updateEscrowsList()
      }

      function selectAccount(index) {
        selectedAccount = accounts[index]
        updateAccountsList()
        log(`Selected account: ${selectedAccount.address}`)
      }

      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            showToast("Copied to clipboard!", "success")
          })
          .catch(() => {
            logError("Failed to copy to clipboard")
          })
      }

      // Backwards compatibility
      function copyAddress(address) {
        copyToClipboard(address)
      }

      function updateAccountDropdowns() {
        const escrowSourceSelect = document.getElementById(
          "escrowSourceAccount",
        )
        const destSelect = document.getElementById("escrowDestination")
        const finishSourceSelect = document.getElementById(
          "finishSourceAccount",
        )
        const ownerSelect = document.getElementById("ownerAccount")
        const customSourceSelect = document.getElementById(
          "customSourceAccount",
        )

        ;[
          escrowSourceSelect,
          destSelect,
          finishSourceSelect,
          ownerSelect,
          customSourceSelect,
        ].forEach((select) => {
          if (select) {
            select.innerHTML = '<option value="">Select account...</option>'
            accounts.forEach((account, index) => {
              select.innerHTML += `<option value="${index}">Account ${index + 1} - ${account.address.substring(0, 10)}...</option>`
            })
          }
        })

        // Update escrow dropdown
        const escrowSelect = document.getElementById("escrowSelect")
        if (escrowSelect) {
          escrowSelect.innerHTML =
            '<option value="">Select an escrow to finish...</option>'
          escrows.forEach((escrow, index) => {
            escrowSelect.innerHTML += `<option value="${index}">Escrow ${index + 1} (Seq: ${escrow.sequence}, ${escrow.amount} drops)</option>`
          })
        }
      }

      async function updateEscrowsList() {
        const escrowsList = document.getElementById("escrowsList")

        if (escrows.length === 0) {
          escrowsList.innerHTML = `
                    <div class="empty-state">
                        No escrows created. Deploy WASM to create escrows.
                    </div>
                `
          return
        }

        let html = ""
        for (let i = 0; i < escrows.length; i++) {
          const escrow = escrows[i]

          html += `
                    <div class="escrow-item" onclick="selectEscrow(${i})">
                        <div class="item-header">
                            <div>
                                <strong>Escrow ${i + 1}</strong>
                                ${
                                  escrow.id
                                    ? `<div class="item-meta">
                                  ID: ${escrow.id.substring(0, 16)}...
                                  <button class="btn btn-small" onclick="copyToClipboard('${escrow.id}'); event.stopPropagation();" title="Copy escrow ID">üìã</button>
                                </div>`
                                    : ""
                                }
                                <div class="item-meta">
                                  Sequence: ${escrow.sequence}
                                </div>
                            </div>
                            <div class="item-meta-right">
                                <div><strong>${escrow.amount} drops</strong></div>
                                <div class="item-meta">${new Date(escrow.timestamp).toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="item-details">
                            <div>Owner: ${escrow.owner.substring(0, 15)}...</div>
                            <div>Destination: ${escrow.destination.substring(0, 15)}...</div>
                        </div>
                    </div>
                `
        }

        escrowsList.innerHTML = html
      }

      function selectEscrow(index) {
        const escrowSelect = document.getElementById("escrowSelect")
        if (escrowSelect) {
          escrowSelect.value = index
          updateFinishFormFromEscrow()
        }

        // Switch to finish escrow tab
        const finishTab = document.querySelector(
          "button[onclick=\"switchTxTab('escrow-finish')\"]",
        )
        if (finishTab) {
          finishTab.click()
        }
      }

      function updateFinishFormFromEscrow() {
        const escrowSelect = document.getElementById("escrowSelect")
        const selectedIndex = escrowSelect.value

        if (selectedIndex === "" || !escrows[selectedIndex]) {
          document.getElementById("finishSourceAccount").value = ""
          document.getElementById("ownerAccount").value = ""
          document.getElementById("offerSequence").value = ""
          return
        }

        const escrow = escrows[selectedIndex]

        // Find account indices for dropdowns
        const ownerIndex = accounts.findIndex(
          (acc) => acc.address === escrow.owner,
        )
        const destIndex = accounts.findIndex(
          (acc) => acc.address === escrow.destination,
        )

        // Auto-fill the finish escrow form
        if (destIndex !== -1) {
          document.getElementById("finishSourceAccount").value = destIndex
        }
        if (ownerIndex !== -1) {
          document.getElementById("ownerAccount").value = ownerIndex
        }
        document.getElementById("offerSequence").value = escrow.sequence

        log(
          `Selected escrow ${parseInt(selectedIndex) + 1} (sequence: ${escrow.sequence})`,
        )
      }

      // Transaction Functions

      function updateCustomTxAccount() {
        const sourceIndex = document.getElementById("customSourceAccount").value
        const customTxArea = document.getElementById("customTx")

        if (sourceIndex === "") {
          customTxArea.value = ""
          return
        }

        const sourceAccount = accounts[parseInt(sourceIndex)]
        const template = {
          Account: sourceAccount.address,
        }

        customTxArea.value = JSON.stringify(template, null, 2)
      }

      async function finishEscrow() {
        if (!client || !client.isConnected()) {
          logError("Please connect to network first", "warning")
          return
        }

        const sourceIndex = document.getElementById("finishSourceAccount").value
        const ownerIndex = document.getElementById("ownerAccount").value
        const sequence = document.getElementById("offerSequence").value

        if (!sourceIndex) {
          logError("Please select a source account", "warning")
          return
        }

        if (!ownerIndex || !sequence) {
          logError(
            "Please select owner account and enter offer sequence",
            "warning",
          )
          return
        }

        // Set loading state
        const finishBtn = document.querySelector(
          "button[onclick='finishEscrow()']",
        )
        const originalText = finishBtn.textContent
        finishBtn.disabled = true
        finishBtn.textContent = "Finishing..."

        try {
          const sourceAccount = accounts[parseInt(sourceIndex)]
          const ownerAccount = accounts[parseInt(ownerIndex)]

          const tx = {
            TransactionType: "EscrowFinish",
            Account: sourceAccount.address,
            Owner: ownerAccount.address,
            OfferSequence: parseInt(sequence),
          }

          // Get computation allowance from advanced options, or use default
          const computationAllowance = document
            .getElementById("finishComputationAllowance")
            .value.trim()
          tx.ComputationAllowance = computationAllowance
            ? parseInt(computationAllowance)
            : 1000000

          // Add advanced options if provided
          const memos = document.getElementById("finishMemos").value.trim()
          if (memos) {
            try {
              tx.Memos = JSON.parse(memos)
            } catch (e) {
              log(`‚ö†Ô∏è Invalid Memos JSON format: ${e.message}`)
            }
          }

          const fulfillment = document
            .getElementById("finishFulfillment")
            .value.trim()
          if (fulfillment) {
            tx.Fulfillment = fulfillment
          }

          const customFields = document
            .getElementById("finishCustomFields")
            .value.trim()
          if (customFields) {
            try {
              const custom = JSON.parse(customFields)
              Object.assign(tx, custom)
            } catch (e) {
              log(`‚ö†Ô∏è Invalid Custom Fields JSON format: ${e.message}`)
            }
          }

          log(
            `Finishing escrow with sequence: ${sequence} from ${sourceAccount.address}`,
          )
          const result = await client.submitAndWait(tx, {
            autofill: true,
            wallet: sourceAccount,
          })

          if (result.result.meta.TransactionResult === "tesSUCCESS") {
            log(`‚úÖ Escrow finished successfully!`)
            logWithExplorer(
              `Transaction hash: ${result.result.hash}`,
              result.result.hash,
            )

            // Remove the finished escrow from the list
            const sequenceNum = parseInt(sequence)
            escrows = escrows.filter(
              (escrow) => escrow.sequence !== sequenceNum,
            )
            await updateEscrowsList()

            // Clear the finish form
            document.getElementById("escrowSelect").value = ""
            document.getElementById("finishSourceAccount").value = ""
            document.getElementById("ownerAccount").value = ""
            document.getElementById("offerSequence").value = ""
            document.getElementById("finishMemos").value = ""
            document.getElementById("finishFulfillment").value = ""
            document.getElementById("finishComputationAllowance").value =
              "1000000"
            document.getElementById("finishCustomFields").value = ""
          } else {
            const transactionResult = result.result.meta.TransactionResult
            log(`‚ùå Escrow finish failed: ${transactionResult}`)
            if (transactionResult.startsWith("tec")) {
              logWithExplorer(
                `Transaction hash: ${result.result.hash}`,
                result.result.hash,
              )
            }
          }

          await updateAccountsList()
        } catch (error) {
          logError(`Failed to finish escrow: ${error.message}`)
        } finally {
          // Restore button state
          finishBtn.disabled = false
          finishBtn.textContent = originalText
        }
      }

      async function submitCustomTransaction() {
        if (!client || !client.isConnected()) {
          logError("Please connect to network first", "warning")
          return
        }

        const sourceIndex = document.getElementById("customSourceAccount").value
        const txJson = document.getElementById("customTx").value

        if (!sourceIndex) {
          logError("Please select a source account", "warning")
          return
        }

        // Set loading state
        const submitBtn = document.querySelector(
          "button[onclick='submitCustomTransaction()']",
        )
        const originalText = submitBtn.textContent
        submitBtn.disabled = true
        submitBtn.textContent = "Submitting..."

        try {
          const sourceAccount = accounts[parseInt(sourceIndex)]
          const tx = JSON.parse(txJson)
          tx.Account = sourceAccount.address // Ensure account is set

          log(
            `Submitting custom transaction: ${tx.TransactionType} from ${sourceAccount.address}`,
          )
          const result = await client.submitAndWait(tx, {
            autofill: true,
            wallet: sourceAccount,
          })

          if (result.result.meta.TransactionResult === "tesSUCCESS") {
            log(`‚úÖ Transaction successful!`)
            logWithExplorer(
              `Transaction hash: ${result.result.hash}`,
              result.result.hash,
            )

            // Clear the custom transaction form
            document.getElementById("customSourceAccount").value = ""
            document.getElementById("customTx").value = ""
          } else {
            const transactionResult = result.result.meta.TransactionResult
            log(`‚ùå Transaction failed: ${transactionResult}`)
            if (transactionResult.startsWith("tec")) {
              logWithExplorer(
                `Transaction hash: ${result.result.hash}`,
                result.result.hash,
              )
            }
          }

          await updateAccountsList()
        } catch (error) {
          logError(`Failed to submit transaction: ${error.message}`)
        } finally {
          // Restore button state
          submitBtn.disabled = false
          submitBtn.textContent = originalText
        }
      }

      // Smart Escrow Testing
      async function deployCurrentWasm() {
        if (!currentWasm) {
          logError("Please load WASM code first", "warning")
          return
        }

        if (!client || !client.isConnected()) {
          logError("Please connect to network first", "warning")
          return
        }

        const sourceIndex = document.getElementById("escrowSourceAccount").value
        const destIndex = document.getElementById("escrowDestination").value
        const amount = document.getElementById("escrowAmount").value

        if (!sourceIndex) {
          logError("Please select a source account", "warning")
          return
        }

        if (!destIndex) {
          logError("Please select a destination account", "warning")
          return
        }

        if (accounts.length < 1) {
          logError(
            "Need at least 1 account for escrow testing. Generate more accounts.",
            "warning",
          )
          return
        }

        // Set loading state
        const deployBtn = document.querySelector(
          "button[onclick='deployCurrentWasm()']",
        )
        const originalText = deployBtn.textContent
        deployBtn.disabled = true
        deployBtn.textContent = "Deploying..."

        try {
          const sourceAccount = accounts[parseInt(sourceIndex)]
          const destAccount = accounts[parseInt(destIndex)]

          const ledgerResponse = await client.request({
            command: "ledger",
            ledger_index: "validated",
          })
          const closeTime = ledgerResponse.result.ledger.close_time

          const tx = {
            TransactionType: "EscrowCreate",
            Account: sourceAccount.address,
            Amount: amount,
            Destination: destAccount.address,
            CancelAfter: closeTime + 2000,
            FinishFunction: currentWasm,
            Data: xrpl.xrpToDrops(70),
          }

          // Add advanced options if provided
          const memos = document.getElementById("deployMemos").value.trim()
          if (memos) {
            try {
              tx.Memos = JSON.parse(memos)
            } catch (e) {
              log(`‚ö†Ô∏è Invalid Memos JSON format: ${e.message}`)
            }
          }

          const condition = document
            .getElementById("deployCondition")
            .value.trim()
          if (condition) {
            tx.Condition = condition
          }

          const data = document.getElementById("deployData").value.trim()
          if (data) {
            tx.Data = data
          }

          const destinationTag = document
            .getElementById("deployDestinationTag")
            .value.trim()
          if (destinationTag) {
            tx.DestinationTag = parseInt(destinationTag)
          }

          const customFields = document
            .getElementById("deployCustomFields")
            .value.trim()
          if (customFields) {
            try {
              const custom = JSON.parse(customFields)
              Object.assign(tx, custom)
            } catch (e) {
              log(`‚ö†Ô∏è Invalid Custom Fields JSON format: ${e.message}`)
            }
          }

          log(
            `üöÄ Deploying WASM as Smart Escrow: ${amount} drops from ${sourceAccount.address} to ${destAccount.address}`,
          )
          const result = await client.submitAndWait(tx, {
            autofill: true,
            wallet: sourceAccount,
          })

          if (result.result.meta.TransactionResult === "tesSUCCESS") {
            lastOfferSequence = result.result.tx_json.Sequence
            document.getElementById("offerSequence").value = lastOfferSequence
            log(
              `‚úÖ Smart Escrow deployed successfully! Sequence: ${lastOfferSequence}`,
            )
            logWithExplorer(
              `Transaction hash: ${result.result.hash}`,
              result.result.hash,
            )

            // Extract escrow ID from transaction metadata
            let escrowId = null
            if (result.result.meta.AffectedNodes) {
              for (const node of result.result.meta.AffectedNodes) {
                if (
                  node.CreatedNode &&
                  node.CreatedNode.LedgerEntryType === "Escrow"
                ) {
                  escrowId = node.CreatedNode.LedgerIndex
                  break
                }
              }
            }

            // Store the successful escrow
            escrows.push({
              sequence: lastOfferSequence,
              owner: sourceAccount.address,
              destination: destAccount.address,
              amount: amount,
              timestamp: Date.now(),
              hash: result.result.hash,
              id: escrowId,
            })

            // Update escrows list
            await updateEscrowsList()

            // Auto-fill the finish escrow form
            document.getElementById("finishSourceAccount").value = destIndex
            document.getElementById("ownerAccount").value = sourceIndex

            // Clear the deploy form
            document.getElementById("escrowSourceAccount").value = ""
            document.getElementById("escrowDestination").value = ""
            document.getElementById("escrowAmount").value = "100000"
            document.getElementById("deployMemos").value = ""
            document.getElementById("deployCondition").value = ""
            document.getElementById("deployData").value = ""
            document.getElementById("deployDestinationTag").value = ""
            document.getElementById("deployCustomFields").value = ""
          } else {
            const transactionResult = result.result.meta.TransactionResult
            log(`‚ùå Smart Escrow deployment failed: ${transactionResult}`)
            if (transactionResult.startsWith("tec")) {
              logWithExplorer(
                `Transaction hash: ${result.result.hash}`,
                result.result.hash,
              )
            }
          }

          await updateAccountsList()
        } catch (error) {
          logError(`Failed to deploy Smart Escrow: ${error.message}`)
        } finally {
          // Restore button state
          deployBtn.disabled = false
          deployBtn.textContent = originalText
        }
      }

      // Keyboard shortcuts
      document.addEventListener("keydown", function (e) {
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
          e.preventDefault()

          // Find the active tab and submit the appropriate form
          const activeTab = document.querySelector(".tab-content.active")
          if (activeTab) {
            const tabId = activeTab.id
            if (tabId === "deploy-wasm-tab") {
              deployCurrentWasm()
            } else if (tabId === "escrow-finish-tab") {
              finishEscrow()
            } else if (tabId === "custom-tab") {
              submitCustomTransaction()
            }
          }
        }
      })

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        log("Smart Escrow Testing UI loaded")

        // Check if XRPL library is available
        if (typeof xrpl === "undefined") {
          log("‚ö†Ô∏è XRPL library is loading...")
          // Wait a bit for the library to load
          setTimeout(() => {
            if (typeof xrpl === "undefined") {
              logError(
                "‚ùå XRPL library failed to load. Please refresh the page. Make sure you have an internet connection.",
              )
            } else {
              log("‚úÖ XRPL library loaded successfully")
              log("Connect to a network and generate accounts to get started")
            }
          }, 2000)
        } else {
          log("‚úÖ XRPL library loaded successfully")
          log("Connect to a network and generate accounts to get started")
        }
      })
    </script>
  </body>
</html>
